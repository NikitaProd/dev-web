<!doctype html>
<html lang="fr_FR">
<head>
	<meta charset="UTF-8">
	<title>Utilisation d'évenements personnalisés</title>
	<style type="text/css">
		a {
			margin: 8px;
		}

		li {
			margin: 8px;
		}
	</style>
	<script type="text/javascript" src="../../lib/lib.js"></script>
	<script type="text/javascript">

		var tasks;

		function init() {
			tasks = [{id: 112, data: 'pain'}, {id: 117, data: 'beurre'}, {id: 119, data: 'lessive'}];
			updateList(tasks);
			addEventListener('removeItem', function(event){
				console.log('removeItem : ', event.detail.taskId);
			});
		}

		function updateList(tasks) {
			var listItems = tasks.map(getItemList);

			listItems.forEach(function (item) {
				byId('liste').appendChild(item);
			});
		}

		function getItemList(item) {
			var li = document.createElement('li');
			li.appendChild(document.createTextNode(item.data));
			li.setAttribute('data-task-id', item.id);
			li.addEventListener('click', onListItemClick);

			var btRemove = href('X', "#");
			btRemove.setAttribute('data-task-id', item.id);
			btRemove.addEventListener("click", onRemoveClick);
			li.appendChild(btRemove);

			return li;
		}

		function onListItemClick(event) {
			console.log('item cliqué : ', event.target.getAttribute('data-task-id'));

		}

		function onRemoveClick(event) {
			var removedTaskId = event.target.getAttribute('data-task-id');
			console.log('item supprimé : ', removedTaskId );
			var rmEvent = new CustomEvent(
					'removeItem',
					{
						detail: {taskId: removedTaskId},
						bubbles:true,
						cancelable:true
					}
			);
			event.target.dispatchEvent(rmEvent);
		}

	</script>

</head>
<body onload="init()">

<div id="container">
	<ul id="liste">
		<!-- ce qu'on aimerait +- obtenir
		<li data-task-id="112" onclick="select(112)">Lait</li>
		<li data-task-id="117">Pain</li>
		<li data-task-id="119">Beurre</li>
		-->
	</ul>
</div>


</body>
</html>